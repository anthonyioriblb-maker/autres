<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de Questions - Automatismes DNB</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .theme-selection {
            margin-bottom: 30px;
        }

        .theme-selection h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .themes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .theme-checkbox {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .theme-checkbox:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .theme-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }

        .theme-checkbox label {
            cursor: pointer;
            font-weight: 500;
            color: #333;
        }

        .theme-checkbox input[type="checkbox"]:checked + label {
            color: #667eea;
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .questions-container {
            margin-top: 30px;
            display: none;
        }

        .questions-container.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        .question-item {
            margin-bottom: 20px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .question-item:nth-child(even) {
            border-left-color: #764ba2;
        }

        .question-number {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question-item .theme-badge {
            display: inline-block;
            background: #764ba2;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-left: 10px;
        }

        .question-item .question-text {
            font-size: 1.2em;
            color: #333;
            margin: 15px 0;
            line-height: 1.6;
            font-weight: 500;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .stat-box {
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-box .label {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .stat-box .value {
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
        }

        .select-all-btn {
            margin-bottom: 15px;
        }

        .question-count-section {
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .question-count-section label {
            font-weight: 600;
            color: #667eea;
            font-size: 1.1em;
        }

        .question-count-section input[type="number"] {
            width: 80px;
            padding: 10px;
            font-size: 1.1em;
            border: 2px solid #667eea;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }

        .question-count-section input[type="number"]:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .print-buttons {
            display: none;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .print-buttons.active {
            display: flex;
        }

        .btn-print {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-print:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn-correction {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }

        .btn-correction:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        @media print {
            .container {
                box-shadow: none;
                border-radius: 0;
            }

            .header,
            .theme-selection,
            .question-count-section,
            .buttons,
            .stats,
            .print-buttons,
            .no-print {
                display: none !important;
            }

            .content {
                padding: 10px;
            }

            .question-item {
                page-break-inside: avoid;
                margin-bottom: 25px;
                padding: 15px;
            }

            .correction-space {
                min-height: 80px;
                border-top: 1px dashed #ccc;
                margin-top: 10px;
                padding-top: 10px;
            }

            .correction-space::before {
                content: "R√©ponse : ";
                font-style: italic;
                color: #666;
            }

            body {
                background: white;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .themes-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Styles pour les fractions */
        .fraction {
            display: inline-flex;
            flex-direction: column;
            vertical-align: middle;
            text-align: center;
            font-size: 1em;
            line-height: 1;
            margin: 0 0.1em;
        }

        .fraction .numerator {
            border-bottom: 1px solid #333;
            padding: 0 0.3em 0.1em;
            font-size: 0.9em;
        }

        .fraction .denominator {
            padding: 0.1em 0.3em 0;
            font-size: 0.9em;
        }

        .answer-section {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #d4edda;
            border-left: 4px solid #28a745;
            border-radius: 8px;
        }

        .answer-section.visible {
            display: block;
        }

        .answer-section strong {
            color: #155724;
        }

        .answer-text {
            color: #155724;
            margin-top: 8px;
            font-weight: 500;
        }

        .btn-show-answers {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            color: #000;
        }

        .btn-show-answers:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        @media print {
            .answer-section.print-mode {
                display: block !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìê G√©n√©rateur de Questions</h1>
            <p>Automatismes pour le Dipl√¥me National du Brevet</p>
        </div>

        <div class="content">
            <div class="theme-selection">
                <h2>S√©lectionnez les th√®mes :</h2>

                <div class="buttons select-all-btn">
                    <button class="btn btn-success" onclick="selectAllThemes()">Tout s√©lectionner</button>
                    <button class="btn btn-secondary" onclick="deselectAllThemes()">Tout d√©s√©lectionner</button>
                </div>

                <div class="themes-grid" id="themesGrid"></div>
            </div>

            <div class="question-count-section">
                <label for="questionCount">Nombre de questions :</label>
                <input type="number" id="questionCount" min="1" max="50" value="1">
            </div>

            <div class="buttons">
                <button class="btn btn-primary" onclick="generateQuestions()">üé≤ G√©n√©rer les questions</button>
                <button class="btn btn-secondary" onclick="resetStats()">üîÑ R√©initialiser</button>
            </div>

            <div class="stats" id="statsSection" style="display: none;">
                <div class="stat-box">
                    <div class="label">Questions g√©n√©r√©es</div>
                    <div class="value" id="questionsCount">0</div>
                </div>
            </div>

            <div class="print-buttons" id="printButtons">
                <button class="btn btn-print" onclick="printQuestions()">üñ®Ô∏è Imprimer les questions</button>
                <button class="btn btn-correction" onclick="printWithCorrection()">üìù Imprimer avec espace correction</button>
                <button class="btn btn-show-answers" onclick="toggleAnswers()">üëÅÔ∏è Afficher/Masquer le corrig√©</button>
                <button class="btn btn-print" onclick="printAnswers()">üñ®Ô∏è Imprimer le corrig√©</button>
            </div>

            <div class="questions-container" id="questionsContainer">
            </div>
        </div>
    </div>

    <script>
        // Utilitaires pour g√©n√©rer des nombres al√©atoires
        function randInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function randChoice(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        function randDecimal(min, max, decimals = 1) {
            const num = Math.random() * (max - min) + min;
            return Math.round(num * Math.pow(10, decimals)) / Math.pow(10, decimals);
        }

        // Fonction pour convertir un nombre en notation fran√ßaise (virgule au lieu du point)
        function toFrenchNumber(num) {
            return num.toString().replace('.', ',');
        }

        // Fonction pour formater les fractions en HTML
        function formatFraction(numerator, denominator) {
            return `<span class="fraction"><span class="numerator">${numerator}</span><span class="denominator">${denominator}</span></span>`;
        }

        // G√©n√©rateurs de questions avec valeurs al√©atoires
        // Les g√©n√©rateurs peuvent retourner :
        // - Un objet {question, answer} pour une question simple
        // - Un tableau [{question, answer}, {question, answer}] pour une paire th√©orie-pratique
        const automatismes = {
            "Nombres et calculs": [
                {
                    desc: "√âcriture d√©cimale des fractions simples",
                    generator: () => {
                        const fractions = [
                            {n: 1, d: 2}, {n: 1, d: 4}, {n: 3, d: 4},
                            {n: 3, d: 2}, {n: 5, d: 2}, {n: 1, d: 10},
                            {n: 1, d: 5}, {n: 2, d: 5}, {n: 4, d: 5}
                        ];
                        const f = randChoice(fractions);
                        const result = toFrenchNumber(f.n / f.d);
                        return {
                            question: `Donner l'√©criture d√©cimale de ${formatFraction(f.n, f.d)}`,
                            answer: result
                        };
                    }
                },
                {
                    desc: "Comparer et calculer avec des nombres d√©cimaux",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randDecimal(-5, 5);
                                const b = randDecimal(-5, 5);
                                const result = a + b;
                                return {
                                    question: `Calculer : ${toFrenchNumber(a)} + (${toFrenchNumber(b)})`,
                                    answer: toFrenchNumber(result)
                                };
                            },
                            () => {
                                const a = randDecimal(1, 10);
                                const b = randDecimal(1, 5);
                                const result = a * b;
                                return {
                                    question: `Calculer : ${toFrenchNumber(a)} √ó ${toFrenchNumber(b)}`,
                                    answer: toFrenchNumber(result)
                                };
                            },
                            () => {
                                const a = randDecimal(-10, 10);
                                const b = randDecimal(-10, 10);
                                const comparison = a < b ? `${toFrenchNumber(a)} < ${toFrenchNumber(b)}` : a > b ? `${toFrenchNumber(a)} > ${toFrenchNumber(b)}` : `${toFrenchNumber(a)} = ${toFrenchNumber(b)}`;
                                return {
                                    question: `Comparer ${toFrenchNumber(a)} et ${toFrenchNumber(b)}`,
                                    answer: comparison
                                };
                            },
                            () => {
                                const nums = [randDecimal(-5, 5), randDecimal(-5, 5), randDecimal(-5, 5), randDecimal(-5, 5)];
                                const sorted = [...nums].sort((a, b) => a - b);
                                return {
                                    question: `Ranger dans l'ordre croissant : ${nums.map(toFrenchNumber).join(' ; ')}`,
                                    answer: sorted.map(toFrenchNumber).join(' < ')
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Simplifier, comparer et calculer avec des fractions",
                    generator: () => {
                        const ops = [
                            () => {
                                const pgcd = randChoice([2, 3, 4, 5, 6]);
                                const a = randInt(2, 6) * pgcd;
                                const b = randInt(3, 8) * pgcd;
                                const simplified_a = a / pgcd;
                                const simplified_b = b / pgcd;
                                return {
                                    question: `Simplifier la fraction ${formatFraction(a, b)}`,
                                    answer: formatFraction(simplified_a, simplified_b)
                                };
                            },
                            () => {
                                const a = randInt(1, 5);
                                const b = randInt(2, 6);
                                const c = randInt(1, 5);
                                const d = randInt(2, 6);
                                const num = a * d + c * b;
                                const den = b * d;
                                return {
                                    question: `Calculer : ${formatFraction(a, b)} + ${formatFraction(c, d)}`,
                                    answer: formatFraction(num, den)
                                };
                            },
                            () => {
                                const a = randInt(1, 5);
                                const b = randInt(2, 6);
                                const c = randInt(1, 5);
                                const d = randInt(2, 6);
                                const num = a * c;
                                const den = b * d;
                                return {
                                    question: `Calculer : ${formatFraction(a, b)} √ó ${formatFraction(c, d)}`,
                                    answer: formatFraction(num, den)
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Prendre une fraction simple d'un nombre",
                    generator: () => {
                        const fractions = [
                            {text: "le tiers", mult: 3, num: 1, den: 3},
                            {text: "le quart", mult: 4, num: 1, den: 4},
                            {text: "la moiti√©", mult: 2, num: 1, den: 2},
                            {text: "les " + formatFraction(2, 3), mult: 3, num: 2, den: 3},
                            {text: "les " + formatFraction(3, 4), mult: 4, num: 3, den: 4}
                        ];
                        const f = randChoice(fractions);
                        const n = randInt(2, 10) * f.mult;
                        const result = (n * f.num) / f.den;
                        return {
                            question: `Calculer ${f.text} de ${n}`,
                            answer: `${result}`
                        };
                    }
                },
                {
                    desc: "D√©terminer un pourcentage",
                    generator: () => {
                        const pcts = [100, 50, 25, 10, 1];
                        const pct = randChoice(pcts);
                        const n = randInt(20, 200);
                        const result = (pct * n) / 100;
                        return {
                            question: `Calculer ${pct}% de ${n}`,
                            answer: toFrenchNumber(result)
                        };
                    }
                },
                {
                    desc: "√âcritures multiples d'un m√™me nombre",
                    generator: () => {
                        const ops = [
                            () => {
                                const decimals = [0.5, 1.5, 2.5, 0.25, 0.75, 1.25, 0.2, 0.4, 0.6, 0.8];
                                const n = randChoice(decimals);
                                const num = n * (n < 1 ? (n === 0.5 ? 2 : n === 0.25 ? 4 : n === 0.75 ? 4 : 5) : 2);
                                const den = n < 1 ? (n === 0.5 ? 2 : n === 0.25 ? 4 : n === 0.75 ? 4 : 5) : 2;
                                return {
                                    question: `√âcrire ${toFrenchNumber(n)} sous forme de fraction`,
                                    answer: formatFraction(num, den)
                                };
                            },
                            () => {
                                const nums = [
                                    {val: 0.25, pct: 25}, {val: 0.5, pct: 50}, {val: 0.75, pct: 75},
                                    {val: 0.2, pct: 20}, {val: 0.4, pct: 40}, {val: 0.6, pct: 60}, {val: 0.8, pct: 80}
                                ];
                                const chosen = randChoice(nums);
                                return {
                                    question: `√âcrire ${toFrenchNumber(chosen.val)} en pourcentage`,
                                    answer: `${chosen.pct}%`
                                };
                            },
                            () => {
                                const fracs = [
                                    {a: 1, b: 2, pct: 50}, {a: 1, b: 4, pct: 25}, {a: 3, b: 4, pct: 75},
                                    {a: 1, b: 5, pct: 20}, {a: 2, b: 5, pct: 40}
                                ];
                                const f = randChoice(fracs);
                                return {
                                    question: `Convertir ${formatFraction(f.a, f.b)} en pourcentage`,
                                    answer: `${f.pct}%`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Notation scientifique",
                    generator: () => {
                        const ops = [
                            () => {
                                const n = randInt(100, 9999);
                                const str = n.toString();
                                const exp = str.length - 1;
                                const mantisse = toFrenchNumber(n / Math.pow(10, exp));
                                return {
                                    question: `√âcrire ${n} en notation scientifique`,
                                    answer: `${mantisse} √ó 10<sup>${exp}</sup>`
                                };
                            },
                            () => {
                                const a = randDecimal(1, 9.9);
                                const exp = randInt(2, 5);
                                const result = a * Math.pow(10, exp);
                                return {
                                    question: `Convertir ${toFrenchNumber(a)} √ó 10<sup>${exp}</sup> en √©criture d√©cimale`,
                                    answer: toFrenchNumber(result)
                                };
                            },
                            () => {
                                const n = randDecimal(0.001, 0.099, 3);
                                const str = n.toString();
                                const exp = -(str.indexOf(str.replace(/^0\./,'').replace(/^0+/, '')[0]) - 1);
                                const mantisse = toFrenchNumber(n * Math.pow(10, exp));
                                return {
                                    question: `√âcrire ${toFrenchNumber(n)} en notation scientifique`,
                                    answer: `${mantisse} √ó 10<sup>-${exp}</sup>`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Carr√©s des nombres de 1 √† 12",
                    generator: () => {
                        const n = randInt(1, 12);
                        return {
                            question: `Calculer ${n}¬≤`,
                            answer: `${n * n}`
                        };
                    }
                },
                {
                    desc: "Crit√®res de divisibilit√©",
                    generator: () => {
                        const div = randChoice([2, 3, 5, 9]);
                        const n = randInt(100, 500);
                        let isDivisible = false;
                        if (div === 2) isDivisible = n % 2 === 0;
                        else if (div === 3) isDivisible = n % 3 === 0;
                        else if (div === 5) isDivisible = n % 5 === 0;
                        else if (div === 9) isDivisible = n % 9 === 0;
                        return {
                            question: `Le nombre ${n} est-il divisible par ${div} ?`,
                            answer: isDivisible ? `Oui, ${n} √∑ ${div} = ${n / div}` : "Non"
                        };
                    }
                },
                {
                    desc: "Expressions autour d'un nombre entier",
                    generator: () => {
                        const exprs = [
                            {text: "le double de n", answer: "2n ou 2 √ó n"},
                            {text: "le triple de n", answer: "3n ou 3 √ó n"},
                            {text: "la moiti√© de n", answer: "n/2 ou n √∑ 2"},
                            {text: "le successeur de n", answer: "n + 1"},
                            {text: "le pr√©d√©cesseur de n", answer: "n - 1"},
                            {text: "le carr√© de n", answer: "n¬≤"}
                        ];
                        const expr = randChoice(exprs);
                        return {
                            question: `Exprimer ${expr.text}`,
                            answer: expr.answer
                        };
                    }
                },
                {
                    desc: "Simplifier des expressions litt√©rales",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randInt(2, 9);
                                const b = randInt(2, 9);
                                const sum = a + b;
                                return {
                                    question: `Simplifier : ${a}x + ${b}x`,
                                    answer: `${sum}x`
                                };
                            },
                            () => {
                                const a = randInt(3, 9);
                                const b = randInt(2, 6);
                                return {
                                    question: `Simplifier : ${a}(x + ${b})`,
                                    answer: `${a}x + ${a * b}`
                                };
                            },
                            () => {
                                const a = randInt(5, 12);
                                const b = randInt(2, 5);
                                const c = randInt(1, 4);
                                const result = a - b + c;
                                return {
                                    question: `Simplifier : ${a}y - ${b}y + ${c}y`,
                                    answer: `${result}y`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Calculer la valeur d'une expression alg√©brique",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randInt(2, 5);
                                const b = randInt(3, 9);
                                const x = randInt(1, 5);
                                const result = a * x + b;
                                return {
                                    question: `Calculer ${a}x + ${b} pour x = ${x}`,
                                    answer: `${result}`
                                };
                            },
                            () => {
                                const a = randInt(1, 5);
                                const x = randInt(2, 6);
                                const result = x * x - a;
                                return {
                                    question: `Calculer x¬≤ - ${a} pour x = ${x}`,
                                    answer: `${result}`
                                };
                            },
                            () => {
                                const a = randInt(2, 4);
                                const b = randInt(2, 5);
                                const x = randInt(2, 4);
                                const result = a * x * x + b * x;
                                return {
                                    question: `Calculer ${a}x¬≤ + ${b}x pour x = ${x}`,
                                    answer: `${result}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "D√©velopper et factoriser",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randInt(2, 7);
                                const b = randInt(2, 9);
                                return {
                                    question: `D√©velopper : ${a}(x + ${b})`,
                                    answer: `${a}x + ${a * b}`
                                };
                            },
                            () => {
                                const a = randInt(2, 7);
                                const b = randInt(2, 9);
                                const c = randInt(2, 6);
                                return {
                                    question: `D√©velopper : ${a}(${b}x - ${c})`,
                                    answer: `${a * b}x - ${a * c}`
                                };
                            },
                            () => {
                                const a = randInt(2, 6);
                                const pgcd = randInt(2, 5);
                                const b = randInt(2, 6);
                                return {
                                    question: `Factoriser : ${a * pgcd}x + ${b * pgcd}`,
                                    answer: `${pgcd}(${a}x + ${b})`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "R√©soudre des √©quations simples",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randInt(2, 9);
                                const c = randInt(6, 36);
                                const x = c / a;
                                return {
                                    question: `R√©soudre : ${a}x = ${c}`,
                                    answer: `x = ${toFrenchNumber(x)}`
                                };
                            },
                            () => {
                                const b = randInt(2, 9);
                                const c = randInt(10, 25);
                                const x = c - b;
                                return {
                                    question: `R√©soudre : x + ${b} = ${c}`,
                                    answer: `x = ${x}`
                                };
                            },
                            () => {
                                const a = randInt(2, 5);
                                const b = randInt(1, 5);
                                const c = randInt(10, 30);
                                const x = (c - b) / a;
                                return {
                                    question: `R√©soudre : ${a}x + ${b} = ${c}`,
                                    answer: `x = ${toFrenchNumber(x)}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Droite gradu√©e",
                    generator: () => {
                        const ops = [
                            () => {
                                const n = randDecimal(0, 10);
                                return {
                                    question: `Placer le point d'abscisse ${toFrenchNumber(n)} sur une droite gradu√©e`,
                                    answer: `Point plac√© √† ${toFrenchNumber(n)} sur la droite`
                                };
                            },
                            () => {
                                const a = randInt(1, 10);
                                const b = randInt(2, 5);
                                const decimal = toFrenchNumber(a / b);
                                return {
                                    question: `Placer le point d'abscisse ${formatFraction(a, b)} sur une droite gradu√©e`,
                                    answer: `Point plac√© √† ${decimal} (soit ${formatFraction(a, b)})`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                }
            ],

            "Espace et g√©om√©trie": [
                {
                    desc: "Rep√®re orthogonal",
                    generator: () => {
                        const x = randInt(-5, 5);
                        const y = randInt(-5, 5);
                        const questions = [
                            {
                                question: `Placer le point A(${x}; ${y}) dans un rep√®re`,
                                answer: `Point plac√© avec abscisse ${x} et ordonn√©e ${y}`
                            },
                            {
                                question: `Lire les coordonn√©es d'un point visible sur un graphique`,
                                answer: `Identifier l'abscisse (x) et l'ordonn√©e (y) du point`
                            },
                            {
                                question: `Quelles sont les coordonn√©es de l'origine du rep√®re ?`,
                                answer: `(0 ; 0)`
                            }
                        ];
                        return randChoice(questions);
                    }
                },
                {
                    desc: "Angles",
                    generator: () => {
                        const ops = [
                            () => ({
                                question: "Quelle est la mesure d'un angle droit ?",
                                answer: "90¬∞"
                            }),
                            () => ({
                                question: "Quelle est la mesure d'un angle plat ?",
                                answer: "180¬∞"
                            }),
                            () => {
                                const a = randInt(30, 80);
                                const result = 90 - a;
                                return {
                                    question: `Deux angles sont compl√©mentaires. L'un mesure ${a}¬∞, calculer l'autre`,
                                    answer: `${result}¬∞`
                                };
                            },
                            () => {
                                const a = randInt(60, 150);
                                const result = 180 - a;
                                return {
                                    question: `Deux angles sont suppl√©mentaires. L'un mesure ${a}¬∞, calculer l'autre`,
                                    answer: `${result}¬∞`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Somme des angles d'un triangle",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randInt(30, 70);
                                const b = randInt(40, 80);
                                const c = 180 - a - b;
                                return {
                                    question: `Dans un triangle, deux angles mesurent ${a}¬∞ et ${b}¬∞. Calculer le troisi√®me angle`,
                                    answer: `${c}¬∞`
                                };
                            },
                            () => ({
                                question: "Quelle est la somme des angles d'un triangle ?",
                                answer: "180¬∞"
                            }),
                            () => {
                                const a = randInt(30, 60);
                                const b = 90 - a;
                                return {
                                    question: `Dans un triangle rectangle, un angle aigu mesure ${a}¬∞. Calculer l'autre angle aigu`,
                                    answer: `${b}¬∞`
                                };
                            },
                            () => ({
                                question: "Dans un triangle √©quilat√©ral, quelle est la mesure de chaque angle ?",
                                answer: "60¬∞"
                            })
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Conversions d'unit√©s",
                    generator: () => {
                        const ops = [
                            () => {
                                const n = randDecimal(1, 10);
                                const result = n * 100;
                                return {
                                    question: `Convertir ${toFrenchNumber(n)} m en cm`,
                                    answer: `${toFrenchNumber(result)} cm`
                                };
                            },
                            () => {
                                const n = randInt(100, 5000);
                                const result = n / 1000;
                                return {
                                    question: `Convertir ${n} mm en m`,
                                    answer: `${toFrenchNumber(result)} m`
                                };
                            },
                            () => {
                                const n = randDecimal(1, 5);
                                const result = n * 1000;
                                return {
                                    question: `Convertir ${toFrenchNumber(n)} L en mL`,
                                    answer: `${toFrenchNumber(result)} mL`
                                };
                            },
                            () => {
                                const h = randInt(1, 5);
                                const min = randChoice([15, 30, 45]);
                                const result = h * 60 + min;
                                return {
                                    question: `Convertir ${h} h ${min} min en minutes`,
                                    answer: `${result} min`
                                };
                            },
                            () => {
                                const n = randInt(2, 10);
                                const result = n * 1000;
                                return {
                                    question: `Convertir ${n} km en m`,
                                    answer: `${result} m`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Reconna√Ætre des solides",
                    generator: () => {
                        const questions = [
                            {question: "Combien de faces a un cube ?", answer: "6 faces"},
                            {question: "Combien d'ar√™tes a un pav√© droit ?", answer: "12 ar√™tes"},
                            {question: "Combien de sommets a une pyramide √† base carr√©e ?", answer: "5 sommets (4 √† la base + 1 sommet)"},
                            {question: "D√©crire un prisme droit √† base triangulaire", answer: "Solide √† 5 faces : 2 bases triangulaires et 3 faces lat√©rales rectangulaires"},
                            {question: "Quelle est la diff√©rence entre un cylindre et un c√¥ne ?", answer: "Le cylindre a 2 bases circulaires identiques, le c√¥ne a 1 base circulaire et 1 sommet"}
                        ];
                        return randChoice(questions);
                    }
                },
                {
                    desc: "P√©rim√®tre",
                    generator: () => {
                        const ops = [
                            () => {
                                // Paire th√©orie + pratique pour rectangle
                                const L = randInt(5, 15);
                                const l = randInt(3, 10);
                                const p = 2 * (L + l);
                                return [
                                    {
                                        question: "Quelle est la formule du p√©rim√®tre d'un rectangle ?",
                                        answer: "P√©rim√®tre = 2 √ó (Longueur + largeur)"
                                    },
                                    {
                                        question: `Calculer le p√©rim√®tre d'un rectangle de longueur ${L} cm et largeur ${l} cm`,
                                        answer: `P = 2 √ó (${L} + ${l}) = 2 √ó ${L + l} = ${p} cm`
                                    }
                                ];
                            },
                            () => {
                                const c = randInt(4, 12);
                                const p = 4 * c;
                                return {
                                    question: `Calculer le p√©rim√®tre d'un carr√© de c√¥t√© ${c} cm`,
                                    answer: `${p} cm`
                                };
                            },
                            () => {
                                // Paire th√©orie + pratique pour cercle
                                const r = randInt(3, 10);
                                const p = 2 * 3.14 * r;
                                return [
                                    {
                                        question: "Quelle est la formule du p√©rim√®tre d'un cercle ?",
                                        answer: "P√©rim√®tre = 2 √ó œÄ √ó r"
                                    },
                                    {
                                        question: `Calculer le p√©rim√®tre d'un cercle de rayon ${r} cm (œÄ ‚âà 3,14)`,
                                        answer: `P = 2 √ó 3,14 √ó ${r} = ${toFrenchNumber(p)} cm`
                                    }
                                ];
                            },
                            () => {
                                const c = randInt(3, 8);
                                const p = 3 * c;
                                return {
                                    question: `Un triangle √©quilat√©ral a un c√¥t√© de ${c} cm. Quel est son p√©rim√®tre ?`,
                                    answer: `${p} cm`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Aires",
                    generator: () => {
                        const ops = [
                            () => {
                                // Paire th√©orie + pratique pour rectangle
                                const L = randInt(5, 15);
                                const l = randInt(3, 10);
                                const a = L * l;
                                return [
                                    {
                                        question: "Quelle est la formule de l'aire d'un rectangle ?",
                                        answer: "Aire = Longueur √ó largeur"
                                    },
                                    {
                                        question: `Calculer l'aire d'un rectangle de longueur ${L} cm et largeur ${l} cm`,
                                        answer: `Aire = ${L} √ó ${l} = ${a} cm¬≤`
                                    }
                                ];
                            },
                            () => {
                                // Paire th√©orie + pratique pour triangle
                                const b = randInt(4, 12);
                                const h = randInt(3, 10);
                                const a = (b * h) / 2;
                                return [
                                    {
                                        question: "Quelle est la formule de l'aire d'un triangle ?",
                                        answer: "Aire = (base √ó hauteur) √∑ 2"
                                    },
                                    {
                                        question: `Calculer l'aire d'un triangle de base ${b} cm et hauteur ${h} cm`,
                                        answer: `Aire = (${b} √ó ${h}) √∑ 2 = ${b * h} √∑ 2 = ${toFrenchNumber(a)} cm¬≤`
                                    }
                                ];
                            },
                            () => {
                                // Paire th√©orie + pratique pour disque
                                const r = randInt(3, 10);
                                const a = 3.14 * r * r;
                                return [
                                    {
                                        question: "Quelle est la formule de l'aire d'un disque ?",
                                        answer: "Aire = œÄ √ó r¬≤"
                                    },
                                    {
                                        question: `Calculer l'aire d'un disque de rayon ${r} cm (œÄ ‚âà 3,14)`,
                                        answer: `Aire = 3,14 √ó ${r}¬≤ = 3,14 √ó ${r * r} = ${toFrenchNumber(a)} cm¬≤`
                                    }
                                ];
                            },
                            () => {
                                const c = randInt(5, 12);
                                const a = c * c;
                                return {
                                    question: `Calculer l'aire d'un carr√© de c√¥t√© ${c} cm`,
                                    answer: `${a} cm¬≤`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Volumes",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randInt(3, 8);
                                const v = a * a * a;
                                return {
                                    question: `Calculer le volume d'un cube d'ar√™te ${a} cm`,
                                    answer: `${v} cm¬≥`
                                };
                            },
                            () => {
                                const L = randInt(4, 10);
                                const l = randInt(3, 8);
                                const h = randInt(2, 6);
                                const v = L * l * h;
                                return {
                                    question: `Calculer le volume d'un pav√© droit de dimensions ${L} cm √ó ${l} cm √ó ${h} cm`,
                                    answer: `${v} cm¬≥`
                                };
                            },
                            () => {
                                const B = randInt(15, 40);
                                const h = randInt(5, 15);
                                const v = B * h;
                                return {
                                    question: `Calculer le volume d'un prisme droit d'aire de base ${B} cm¬≤ et de hauteur ${h} cm`,
                                    answer: `${v} cm¬≥`
                                };
                            },
                            () => {
                                // Paire th√©orie + pratique
                                const r = randInt(3, 6);
                                const h = randInt(5, 10);
                                const v = 3.14 * r * r * h;
                                return [
                                    {
                                        question: "Quelle est la formule du volume d'un cylindre ?",
                                        answer: "V = œÄ √ó r¬≤ √ó h"
                                    },
                                    {
                                        question: `Calculer le volume d'un cylindre de rayon ${r} cm et de hauteur ${h} cm (œÄ ‚âà 3,14)`,
                                        answer: `V = 3,14 √ó ${r}¬≤ √ó ${h} = 3,14 √ó ${r*r} √ó ${h} = ${toFrenchNumber(v)} cm¬≥`
                                    }
                                ];
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Th√©or√®me de Pythagore",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randInt(3, 8);
                                const b = randInt(4, 10);
                                const c = Math.sqrt(a * a + b * b);
                                return {
                                    question: `Dans un triangle rectangle, les c√¥t√©s de l'angle droit mesurent ${a} cm et ${b} cm. Calculer l'hypot√©nuse`,
                                    answer: `${toFrenchNumber(c.toFixed(2))} cm`
                                };
                            },
                            () => {
                                // Paire th√©orie + pratique
                                const a = randInt(3, 6);
                                const b = randInt(4, 8);
                                const c = Math.sqrt(a * a + b * b);
                                return [
                                    {
                                        question: "√ânoncer le th√©or√®me de Pythagore",
                                        answer: "Dans un triangle rectangle, le carr√© de l'hypot√©nuse est √©gal √† la somme des carr√©s des deux autres c√¥t√©s"
                                    },
                                    {
                                        question: `Application : Dans un triangle rectangle ABC, AB = ${a} cm et AC = ${b} cm. Calculer BC`,
                                        answer: `BC¬≤ = AB¬≤ + AC¬≤ = ${a}¬≤ + ${b}¬≤ = ${a*a} + ${b*b} = ${a*a + b*b}, donc BC = ${toFrenchNumber(c.toFixed(2))} cm`
                                    }
                                ];
                            },
                            () => {
                                const pythTriples = [[3,4,5], [5,12,13], [8,15,17], [7,24,25]];
                                const [a, b, c] = randChoice(pythTriples);
                                return {
                                    question: `Un triangle a des c√¥t√©s de ${a} cm, ${b} cm et ${c} cm. Est-il rectangle ?`,
                                    answer: `Oui, car ${a}¬≤ + ${b}¬≤ = ${a*a} + ${b*b} = ${a*a + b*b} = ${c}¬≤ = ${c*c}`
                                };
                            },
                            () => {
                                const c = randInt(5, 10);
                                const diag = c * Math.sqrt(2);
                                return {
                                    question: `Calculer la diagonale d'un carr√© de c√¥t√© ${c} cm (arrondir au dixi√®me)`,
                                    answer: `${toFrenchNumber(diag.toFixed(1))} cm`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Th√©or√®me de Thal√®s",
                    generator: () => {
                        const AB = randInt(4, 8);
                        const AC = randInt(6, 12);
                        const AM = randInt(2, 4);
                        const questions = [
                            () => {
                                // Paire th√©orie + pratique
                                const a = randInt(6, 10);
                                const b = randInt(3, 5);
                                const c = randInt(8, 12);
                                return [
                                    {
                                        question: "√ânoncer le th√©or√®me de Thal√®s",
                                        answer: "Si deux droites sont parall√®les, alors les rapports des c√¥t√©s correspondants sont √©gaux"
                                    },
                                    {
                                        question: `Application : Dans des triangles en position de Thal√®s, AB = ${a} cm, AM = ${b} cm, AC = ${c} cm. Si MN // BC, √©crire l'√©galit√© de Thal√®s`,
                                        answer: `AM/AB = AN/AC = MN/BC soit ${b}/${a} = AN/${c} = MN/BC`
                                    }
                                ];
                            },
                            () => ({
                                question: "Dans quelle configuration peut-on utiliser le th√©or√®me de Thal√®s ?",
                                answer: "Configuration papillon (2 droites parall√®les coup√©es par 2 s√©cantes) ou configuration triangle (droite parall√®le √† un c√¥t√©)"
                            }),
                            () => ({
                                question: `Dans des triangles en position de Thal√®s, AB = ${AB}, AC = ${AC}, AM = ${AM}. Si MN // BC, √©crire l'√©galit√© de Thal√®s`,
                                answer: `AM/AB = AN/AC = MN/BC`
                            }),
                            () => ({
                                question: "Citer les conditions d'application du th√©or√®me de Thal√®s",
                                answer: "Deux droites parall√®les coup√©es par deux s√©cantes"
                            })
                        ];
                        return randChoice(questions)();
                    }
                },
                {
                    desc: "Trigonom√©trie - Cosinus",
                    generator: () => {
                        const ops = [
                            () => {
                                // Paire th√©orie + pratique
                                const adj = randInt(3, 8);
                                const hyp = randInt(adj + 2, 12);
                                const cos = adj / hyp;
                                return [
                                    {
                                        question: "Dans un triangle rectangle, quelle est la formule du cosinus d'un angle aigu ?",
                                        answer: "cos(angle) = c√¥t√© adjacent / hypot√©nuse"
                                    },
                                    {
                                        question: `Application : Dans un triangle rectangle, le c√¥t√© adjacent mesure ${adj} cm et l'hypot√©nuse ${hyp} cm. Calculer le cosinus de l'angle`,
                                        answer: `cos = ${adj}/${hyp} = ${toFrenchNumber(cos.toFixed(3))}`
                                    }
                                ];
                            },
                            () => ({
                                question: "D√©finir le cosinus d'un angle aigu dans un triangle rectangle",
                                answer: "cos(angle) = c√¥t√© adjacent / hypot√©nuse"
                            }),
                            () => {
                                const adj = randInt(3, 8);
                                const hyp = randInt(adj + 2, 12);
                                const cos = adj / hyp;
                                return {
                                    question: `Dans un triangle rectangle, le c√¥t√© adjacent mesure ${adj} cm et l'hypot√©nuse ${hyp} cm. Calculer le cosinus de l'angle`,
                                    answer: `cos = ${adj}/${hyp} = ${toFrenchNumber(cos.toFixed(3))}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Sym√©tries et transformations",
                    generator: () => {
                        const ops = [
                            () => {
                                const x = randInt(-5, 5);
                                const y = randInt(-5, 5);
                                return {
                                    question: `Quel est le sym√©trique du point A(${x}; ${y}) par rapport √† l'origine ?`,
                                    answer: `A'(${-x}; ${-y})`
                                };
                            },
                            () => ({
                                question: "Comment construire le sym√©trique d'un point par rapport √† une droite ?",
                                answer: "Tracer la perpendiculaire √† la droite passant par le point, puis reporter la distance de l'autre c√¥t√©"
                            }),
                            () => ({
                                question: "Quelles sont les propri√©t√©s conserv√©es par une sym√©trie centrale ?",
                                answer: "Les distances, les angles, les aires, l'alignement et le parall√©lisme"
                            }),
                            () => ({
                                question: "Construire le sym√©trique d'un triangle par sym√©trie axiale",
                                answer: "Construire le sym√©trique de chaque sommet par rapport √† l'axe, puis relier les points"
                            })
                        ];
                        return randChoice(ops)();
                    }
                }
            ],

            "Organisation et gestion de donn√©es": [
                {
                    desc: "Probabilit√©s simples",
                    generator: () => {
                        const ops = [
                            () => ({
                                question: "On lance un d√© √©quilibr√©. Quelle est la probabilit√© d'obtenir un 6 ?",
                                answer: "1/6"
                            }),
                            () => {
                                const r = randInt(2, 6);
                                const b = randInt(3, 8);
                                const total = r + b;
                                return {
                                    question: `Dans un sac, il y a ${r} boules rouges et ${b} boules bleues. Quelle est la probabilit√© de tirer une boule rouge ?`,
                                    answer: `${r}/${total}`
                                };
                            },
                            () => ({
                                question: "On lance une pi√®ce √©quilibr√©e. Quelle est la probabilit√© d'obtenir pile ?",
                                answer: "1/2 ou 0,5 ou 50%"
                            }),
                            () => ({
                                question: "Calculer la probabilit√© d'obtenir un nombre pair en lan√ßant un d√©",
                                answer: "3/6 = 1/2"
                            }),
                            () => {
                                const n = randInt(4, 8);
                                return {
                                    question: `Dans une situation d'√©quiprobabilit√© avec ${n} issues, quelle est la probabilit√© de chaque issue ?`,
                                    answer: `1/${n}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Fr√©quence",
                    generator: () => {
                        const ops = [
                            () => {
                                const total = randInt(30, 60);
                                const occur = randInt(10, Math.floor(total * 0.6));
                                const freq = occur / total;
                                return {
                                    question: `Sur ${total} lancers, on obtient ${occur} fois pile. Calculer la fr√©quence de pile`,
                                    answer: `${occur}/${total} = ${toFrenchNumber(freq.toFixed(3))}`
                                };
                            },
                            () => {
                                // Paire th√©orie + pratique
                                const total = randInt(40, 60);
                                const occur = randInt(15, 30);
                                const freq = occur / total;
                                return [
                                    {
                                        question: "Comment calculer une fr√©quence ?",
                                        answer: "Fr√©quence = nombre de fois o√π l'√©v√©nement se produit / nombre total d'essais"
                                    },
                                    {
                                        question: `Application : Calculer la fr√©quence d'un √©v√©nement qui s'est produit ${occur} fois sur ${total} essais`,
                                        answer: `Fr√©quence = ${occur}/${total} = ${toFrenchNumber(freq.toFixed(3))}`
                                    }
                                ];
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Moyenne",
                    generator: () => {
                        const ops = [
                            () => {
                                const notes = Array.from({length: 4}, () => randInt(8, 18));
                                const sum = notes.reduce((a, b) => a + b, 0);
                                const avg = sum / notes.length;
                                return {
                                    question: `Calculer la moyenne de : ${notes.join(', ')}`,
                                    answer: `(${notes.join(' + ')}) / ${notes.length} = ${toFrenchNumber(avg.toFixed(2))}`
                                };
                            },
                            () => {
                                // Paire th√©orie + pratique
                                const notes = Array.from({length: 3}, () => randInt(10, 18));
                                const sum = notes.reduce((a, b) => a + b, 0);
                                const avg = sum / notes.length;
                                return [
                                    {
                                        question: "Quelle est la formule de la moyenne ?",
                                        answer: "Moyenne = somme des valeurs / nombre de valeurs"
                                    },
                                    {
                                        question: `Application : Calculer la moyenne de ${notes.join(', ')}`,
                                        answer: `Moyenne = (${notes.join(' + ')}) / ${notes.length} = ${sum} / ${notes.length} = ${toFrenchNumber(avg.toFixed(2))}`
                                    }
                                ];
                            },
                            () => {
                                const n = randInt(4, 6);
                                const moy = randInt(10, 15);
                                const sum = n * moy;
                                return {
                                    question: `La moyenne de ${n} notes est ${moy}. Quelle est la somme des notes ?`,
                                    answer: `${n} √ó ${moy} = ${sum}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "M√©diane",
                    generator: () => {
                        const ops = [
                            () => {
                                const serie = Array.from({length: 5}, () => randInt(1, 20)).sort((a,b) => a-b);
                                const median = serie[2];
                                return {
                                    question: `D√©terminer la m√©diane de la s√©rie : ${serie.join(', ')}`,
                                    answer: `${median} (valeur centrale)`
                                };
                            },
                            () => {
                                // Paire th√©orie + pratique
                                const serie = Array.from({length: 5}, () => randInt(5, 18)).sort((a,b) => a-b);
                                const median = serie[2];
                                return [
                                    {
                                        question: "Comment calculer la m√©diane d'une s√©rie ?",
                                        answer: "Pour une s√©rie ordonn√©e : si impair, prendre la valeur du milieu ; si pair, faire la moyenne des 2 valeurs centrales"
                                    },
                                    {
                                        question: `Application : D√©terminer la m√©diane de ${serie.join(', ')}`,
                                        answer: `S√©rie d√©j√† ordonn√©e avec ${serie.length} valeurs (impair), m√©diane = ${median} (valeur centrale)`
                                    }
                                ];
                            },
                            () => {
                                const serie = Array.from({length: 4}, () => randInt(5, 15)).sort((a,b) => a-b);
                                const median = (serie[1] + serie[2]) / 2;
                                return {
                                    question: `Quelle est la m√©diane de : ${serie.join(', ')} ?`,
                                    answer: `(${serie[1]} + ${serie[2]}) / 2 = ${toFrenchNumber(median)}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Lire tableaux et graphiques",
                    generator: () => {
                        const questions = [
                            {
                                question: "Comment lire un tableau √† double entr√©e ?",
                                answer: "Croiser une ligne et une colonne pour trouver la valeur correspondante"
                            },
                            {
                                question: "Comment interpr√©ter un diagramme en barres ?",
                                answer: "La hauteur de chaque barre repr√©sente la valeur ou l'effectif de la cat√©gorie"
                            },
                            {
                                question: "Qu'est-ce qu'un diagramme circulaire ?",
                                answer: "Graphique en forme de cercle divis√© en secteurs, chaque secteur repr√©sentant une proportion du total"
                            },
                            {
                                question: "Comment extraire une donn√©e d'un tableau statistique ?",
                                answer: "Identifier la ligne et la colonne correspondant √† la donn√©e recherch√©e, puis lire la valeur √† leur intersection"
                            }
                        ];
                        return randChoice(questions);
                    }
                }
            ],

            "Proportionnalit√© et fonctions": [
                {
                    desc: "Reconna√Ætre une situation de proportionnalit√©",
                    generator: () => {
                        const ops = [
                            () => {
                                const p1 = randInt(2, 5);
                                const c1 = p1 * randInt(2, 4);
                                const p2 = randInt(6, 10);
                                const c2 = p2 * (c1 / p1);
                                return {
                                    question: `${p1} kg co√ªtent ${c1}‚Ç¨, ${p2} kg co√ªtent ${c2}‚Ç¨. Y a-t-il proportionnalit√© ?`,
                                    answer: `Oui, car ${c1}/${p1} = ${c2}/${p2} = ${c1/p1}`
                                };
                            },
                            () => ({
                                question: "Comment v√©rifier si un tableau repr√©sente une situation de proportionnalit√© ?",
                                answer: "V√©rifier que tous les rapports entre valeurs correspondantes sont √©gaux (coefficient de proportionnalit√© constant)"
                            }),
                            () => ({
                                question: "Est-ce que le p√©rim√®tre d'un carr√© est proportionnel √† son c√¥t√© ?",
                                answer: "Oui, P = 4 √ó c√¥t√© (coefficient 4)"
                            }),
                            () => ({
                                question: "L'√¢ge et la taille sont-ils proportionnels ?",
                                answer: "Non, la taille ne cro√Æt pas proportionnellement √† l'√¢ge"
                            })
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "R√©soudre un probl√®me de proportionnalit√©",
                    generator: () => {
                        const ops = [
                            () => {
                                const p1 = randInt(2, 5);
                                const c1 = p1 * randInt(3, 6);
                                const p2 = randInt(6, 10);
                                const c2 = (c1 / p1) * p2;
                                return {
                                    question: `Si ${p1} kg co√ªtent ${c1}‚Ç¨, combien co√ªtent ${p2} kg ?`,
                                    answer: `${c2}‚Ç¨ (coefficient : ${c1}/${p1} = ${c1/p1}, donc ${p2} √ó ${c1/p1} = ${c2})`
                                };
                            },
                            () => {
                                const art = randInt(4, 8);
                                const unitPrice = randInt(3, 6);
                                const total = art * unitPrice;
                                return {
                                    question: `${art} articles co√ªtent ${total}‚Ç¨. Combien co√ªte 1 article ?`,
                                    answer: `${total}/${art} = ${unitPrice}‚Ç¨`
                                };
                            },
                            () => {
                                const a = randInt(2, 5);
                                const coef = randInt(2, 5);
                                const b = a * coef;
                                const c = randInt(6, 10);
                                const d = c * coef;
                                return {
                                    question: `Compl√©ter le tableau de proportionnalit√© : ${a}‚Üí${b}, ${c}‚Üí?`,
                                    answer: `${d} (coefficient : ${b}/${a} = ${coef}, donc ${c} √ó ${coef} = ${d})`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Pourcentages - augmentation et diminution",
                    generator: () => {
                        const ops = [
                            () => {
                                const prix = randInt(50, 150);
                                const pct = randChoice([10, 20, 25, 30]);
                                const augmentation = (prix * pct) / 100;
                                const result = prix + augmentation;
                                return {
                                    question: `Augmenter ${prix}‚Ç¨ de ${pct}%`,
                                    answer: `${prix} + (${prix} √ó ${pct}/100) = ${prix} + ${augmentation} = ${result}‚Ç¨`
                                };
                            },
                            () => {
                                const prix = randInt(60, 180);
                                const pct = randChoice([10, 15, 20, 25]);
                                const reduction = (prix * pct) / 100;
                                const result = prix - reduction;
                                return {
                                    question: `Diminuer ${prix}‚Ç¨ de ${pct}%`,
                                    answer: `${prix} - (${prix} √ó ${pct}/100) = ${prix} - ${reduction} = ${result}‚Ç¨`
                                };
                            },
                            () => {
                                const prix = randInt(40, 120);
                                const pct = randChoice([15, 20, 30]);
                                const reduction = (prix * pct) / 100;
                                const result = prix - reduction;
                                return {
                                    question: `Appliquer une r√©duction de ${pct}% sur ${prix}‚Ç¨`,
                                    answer: `${prix} - (${prix} √ó ${pct}/100) = ${prix} - ${reduction} = ${result}‚Ç¨`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Exploiter un graphique",
                    generator: () => {
                        const h = randInt(2, 5);
                        const x = randInt(3, 8);
                        const questions = [
                            {
                                question: `Sur un graphique distance/temps, lire la distance parcourue apr√®s ${h} heures`,
                                answer: `Tracer une verticale √† x = ${h}, puis lire la valeur en ordonn√©e`
                            },
                            {
                                question: "Comment interpr√©ter la pente d'une droite sur un graphique ?",
                                answer: "La pente repr√©sente le taux de variation (vitesse, coefficient de proportionnalit√©, etc.)"
                            },
                            {
                                question: `Lire l'ordonn√©e correspondant √† l'abscisse ${x}`,
                                answer: `Tracer une verticale √† x = ${x}, puis lire la valeur sur l'axe des ordonn√©es`
                            },
                            {
                                question: "Comment identifier un maximum sur un graphique ?",
                                answer: "Le maximum est le point le plus haut de la courbe (ordonn√©e la plus grande)"
                            }
                        ];
                        return randChoice(questions);
                    }
                }
            ],

            "Algorithmique et programmation": [
                {
                    desc: "Interpr√©ter un programme",
                    generator: () => {
                        const ops = [
                            () => {
                                const x = randInt(3, 10);
                                const mult = randInt(2, 5);
                                const add = randInt(3, 8);
                                const result = x * mult + add;
                                return {
                                    question: `Programme : Choisir un nombre, multiplier par ${mult}, ajouter ${add}. Pour x = ${x}, quel est le r√©sultat ?`,
                                    answer: `${x} √ó ${mult} + ${add} = ${x * mult} + ${add} = ${result}`
                                };
                            },
                            () => ({
                                question: "Comment ex√©cuter pas √† pas un algorithme ?",
                                answer: "Suivre chaque instruction l'une apr√®s l'autre en notant les valeurs des variables √† chaque √©tape"
                            }),
                            () => {
                                const x = randInt(2, 8);
                                const a = randInt(2, 4);
                                const b = randInt(3, 7);
                                const result = a * x + b;
                                return {
                                    question: `Programme : x ‚Üí ${a}x + ${b}. Pour x = ${x}, calculer le r√©sultat`,
                                    answer: `${a} √ó ${x} + ${b} = ${a * x} + ${b} = ${result}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                }
            ]
        };

        let questionsGenerated = 0;

        // Initialiser l'interface
        function initThemes() {
            const grid = document.getElementById('themesGrid');
            Object.keys(automatismes).forEach((theme, index) => {
                const div = document.createElement('div');
                div.className = 'theme-checkbox';
                div.innerHTML = `
                    <input type="checkbox" id="theme${index}" value="${theme}" checked>
                    <label for="theme${index}">${theme}</label>
                `;
                grid.appendChild(div);
            });
        }

        function selectAllThemes() {
            document.querySelectorAll('.theme-checkbox input[type="checkbox"]').forEach(cb => {
                cb.checked = true;
            });
        }

        function deselectAllThemes() {
            document.querySelectorAll('.theme-checkbox input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
        }

        // Fonction helper pour normaliser le retour des g√©n√©rateurs
        // Retourne toujours un tableau de {question, answer}
        function normalizeGeneratorOutput(output) {
            if (typeof output === 'string') {
                // Ancien format : juste une question
                return [{ question: output, answer: "√Ä calculer" }];
            }
            // Si c'est d√©j√† un tableau de paires th√©orie-pratique, le retourner tel quel
            if (Array.isArray(output)) {
                return output;
            }
            // Format objet simple : le mettre dans un tableau
            return [output];
        }

        function generateQuestions() {
            const selectedThemes = Array.from(document.querySelectorAll('.theme-checkbox input[type="checkbox"]:checked'))
                .map(cb => cb.value);

            if (selectedThemes.length === 0) {
                alert('Veuillez s√©lectionner au moins un th√®me !');
                return;
            }

            const count = parseInt(document.getElementById('questionCount').value) || 1;
            if (count < 1 || count > 50) {
                alert('Veuillez choisir un nombre de questions entre 1 et 50 !');
                return;
            }

            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';

            // Ensemble pour stocker les questions d√©j√† g√©n√©r√©es et √©viter les doublons
            const generatedQuestions = new Set();
            const maxAttempts = 1000; // Limite pour √©viter une boucle infinie
            let totalQuestionsAdded = 0;
            let questionNumber = 1;

            // G√©n√©rer jusqu'√† atteindre le nombre de questions demand√©
            while (totalQuestionsAdded < count) {
                let questionsArray = null;
                let attempts = 0;
                let randomTheme = '';

                // G√©n√©rer une ou plusieurs questions uniques (paire th√©orie-pratique possible)
                do {
                    // Choisir un th√®me al√©atoire parmi les s√©lectionn√©s
                    randomTheme = selectedThemes[Math.floor(Math.random() * selectedThemes.length)];
                    const themeData = automatismes[randomTheme];

                    // Choisir un automatisme al√©atoire dans ce th√®me
                    const randomAuto = themeData[Math.floor(Math.random() * themeData.length)];

                    // G√©n√©rer la ou les questions avec le g√©n√©rateur
                    const rawOutput = randomAuto.generator();
                    questionsArray = normalizeGeneratorOutput(rawOutput);
                    attempts++;

                    // Si on a essay√© trop de fois, on sort de la boucle
                    if (attempts >= maxAttempts) {
                        console.warn('Nombre maximum de tentatives atteint pour g√©n√©rer une question unique');
                        break;
                    }

                    // V√©rifier qu'aucune des questions du tableau n'est un doublon
                    const hasNoDuplicate = questionsArray.every(q => !generatedQuestions.has(q.question));
                    if (hasNoDuplicate) break;
                } while (true);

                // Ajouter chaque question du tableau (peut √™tre 1 ou 2 questions)
                for (const questionData of questionsArray) {
                    // Ne pas d√©passer le nombre demand√©
                    if (totalQuestionsAdded >= count) break;

                    // Ajouter la question √† l'ensemble pour √©viter les doublons
                    generatedQuestions.add(questionData.question);

                    // Cr√©er l'√©l√©ment de question
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-item';
                    questionDiv.innerHTML = `
                        <span class="question-number">Question ${questionNumber}</span>
                        <span class="theme-badge">${randomTheme}</span>
                        <div class="question-text">${questionData.question}</div>
                        <div class="answer-section">
                            <strong>‚úì Correction :</strong>
                            <div class="answer-text">${questionData.answer}</div>
                        </div>
                    `;
                    container.appendChild(questionDiv);

                    totalQuestionsAdded++;
                    questionNumber++;
                }
            }

            questionsGenerated = totalQuestionsAdded;

            // Afficher le conteneur et les stats
            container.classList.add('active');
            document.getElementById('statsSection').style.display = 'flex';
            document.getElementById('questionsCount').textContent = questionsGenerated;
            document.getElementById('printButtons').classList.add('active');
        }

        function toggleAnswers() {
            document.querySelectorAll('.answer-section').forEach(section => {
                section.classList.toggle('visible');
            });
        }

        function printQuestions() {
            // Masquer les r√©ponses et retirer les espaces de correction
            document.querySelectorAll('.answer-section').forEach(el => el.classList.remove('visible', 'print-mode'));
            document.querySelectorAll('.correction-space').forEach(el => el.remove());
            window.print();
        }

        function printWithCorrection() {
            // Masquer les r√©ponses
            document.querySelectorAll('.answer-section').forEach(el => el.classList.remove('visible', 'print-mode'));
            // Retirer tous les espaces de correction existants
            document.querySelectorAll('.correction-space').forEach(el => el.remove());

            // Ajouter un espace de correction √† chaque question
            document.querySelectorAll('.question-item').forEach(questionItem => {
                const correctionSpace = document.createElement('div');
                correctionSpace.className = 'correction-space';
                questionItem.appendChild(correctionSpace);
            });

            // Lancer l'impression
            window.print();
        }

        function printAnswers() {
            // Retirer les espaces de correction
            document.querySelectorAll('.correction-space').forEach(el => el.remove());
            // Activer les r√©ponses pour l'impression
            document.querySelectorAll('.answer-section').forEach(el => {
                el.classList.remove('visible');
                el.classList.add('print-mode');
            });
            window.print();
            // Nettoyer apr√®s l'impression
            document.querySelectorAll('.answer-section').forEach(el => el.classList.remove('print-mode'));
        }

        function resetStats() {
            questionsGenerated = 0;
            document.getElementById('questionsCount').textContent = '0';
            document.getElementById('questionsContainer').innerHTML = '';
            document.getElementById('questionsContainer').classList.remove('active');
            document.getElementById('statsSection').style.display = 'none';
            document.getElementById('printButtons').classList.remove('active');
            document.getElementById('questionCount').value = '1';
        }

        // Initialiser au chargement
        window.onload = initThemes;
    </script>
</body>
</html>
